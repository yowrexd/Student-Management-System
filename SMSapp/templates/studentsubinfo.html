{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}  

{% block content %}
<div class="p-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Back Button -->
    <div class="mb-6">
        <a href="{% url 'student_info' student.student_id %}" class="text-gray-600 hover:text-gray-800 flex items-center gap-2">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Student Info</span>
        </a>
    </div>

    <!-- Header Info -->
    <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
        <div class="flex justify-between items-start">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ subject.subject_title }}</h2>
                <p class="text-gray-600">{{ subject.subject_code }}</p>
                <p class="text-gray-500 mt-1">{{ subject.get_semester_display }}</p>
            </div>
            <div class="text-right">
                <p class="text-gray-800 font-medium">{{ student.last_name }}, {{ student.first_name }}</p>
                <p class="text-gray-600">{{ student.student_id }}</p>
            </div>
        </div>
    </div>

    <!-- Grades Tabs -->
    <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
        <div class="border-b border-gray-200">
            <nav class="flex -mb-px">
                <button onclick="switchTab('activities')" class="tab-btn active-tab px-6 py-4 border-b-2 text-sm font-medium" data-tab="activities">
                    Activities
                </button>
                <button onclick="switchTab('quiz')" class="tab-btn px-6 py-4 border-b-2 text-sm font-medium" data-tab="quiz">
                    Quiz
                </button>
                <button onclick="switchTab('projects')" class="tab-btn px-6 py-4 border-b-2 text-sm font-medium" data-tab="projects">
                    Projects
                </button>
                <button onclick="switchTab('exams')" class="tab-btn px-6 py-4 border-b-2 text-sm font-medium" data-tab="exams">
                    Exams
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="tab-content" id="quiz">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-green-700">
                        <tr>
                            <th class="px-6 py-3 text-center text-xs font-medium text-white uppercase">Activity Name</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-white uppercase">Total Items</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-white uppercase">Score</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        {% for activity in activities %}
                            {% if activity.activity_type == 'Quiz' %}
                            <tr class="hover:bg-green-100">
                                <td class="ml-4 px-6 py-4 text-sm text-center text-gray-900">{{ activity.activity_name }}</td>
                                <td class="px-6 py-4 text-sm text-center text-gray-600">{{ activity.total_items }}</td>
                                <td class="px-6 py-4 text-center">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-md font-medium {% if grades|get_item:activity.activity_id == 'N/A' %}bg-gray-100 text-gray-800{% else %}bg-green-200 text-green-800{% endif %}">
                                        {{ grades|get_item:activity.activity_id }}
                                    </span>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="px-6 py-8 text-center text-gray-500">
                                    No quizzes assigned yet
                                </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Repeat for other tabs -->
        {% for type in 'Activities,Projects,Exams'|split:',' %}
        <div class="tab-content hidden" id="{{ type|lower }}">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-green-700">
                        <tr>
                            <th class="px-6 py-3 text-center text-xs font-medium text-white uppercase">Activity Name</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-white uppercase">Total Items</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-white uppercase">Score</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        {% for activity in activities %}
                            {% if activity.activity_type == type %}
                            <tr class="hover:bg-green-100">
                                <td class="px-6 py-4 text-sm text-center text-gray-900">{{ activity.activity_name }}</td>
                                <td class="px-6 py-4 text-sm text-center text-gray-600">{{ activity.total_items }}</td>
                                <td class="px-6 py-4 text-center">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-md font-medium {% if grades|get_item:activity.activity_id == 'N/A' %}bg-gray-100 text-gray-800{% else %}bg-green-100 text-green-800{% endif %}">
                                        {{ grades|get_item:activity.activity_id }}
                                    </span>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="px-6 py-8 text-center text-gray-500">
                                    No {{ type|lower }} assigned yet
                                </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.tab-btn {
    @apply text-gray-500 hover:text-green-700 border-transparent hover:bg-gray-100 transition-all duration-200 border-b-2;
}

.active-tab {
    @apply text-white border-[#006837] bg-[#006837] font-semibold;
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.tab-content:first-of-type {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>

<script>
function switchTab(tabId) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active-tab');
    });
    
    // Show selected tab content
    document.getElementById(tabId).style.display = 'block';
    
    // Add active class to selected tab
    document.querySelector(`[data-tab="${tabId}"]`).classList.add('active-tab');
}

// Show the active tab content on page load
document.addEventListener('DOMContentLoaded', function() {
    var activeBtn = document.querySelector('.tab-btn.active-tab');
    if (activeBtn) {
        var tabId = activeBtn.getAttribute('data-tab');
        switchTab(tabId);
    }
});
</script>
{% endblock %}
